<div class="column is-12 mt-4">

  <hr>

  <div class="mt-4">
    <div class="level">
      <div class="level-left">
        <p class="is-size-6 has-text-weight-semibold mb-2">High traffic outliers</p>
      </div>
      <div class="level-right">
        <span class="tag is-size-7" title="Median total requests for this assignment">
          <b>median: </b>&nbsp;{{ median }}
        </span>
        <span class="tag is-size-7 ml-2" title="Current flag threshold (percentile)">
          <b>Cutoff: </b> &nbsp;p{{ pctl_min }}
        </span>
      </div>
    </div>

    <table class="table is-fullwidth is-hoverable is-striped">
      <thead>
        <tr>
          <th>student</th>
          <th class="has-text-right">total requests</th>
          <th class="has-text-right" title="How many requests above the assignment median">over median</th>
          <th class="has-text-right">percentile</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for r in rows %}
        <tr>
          <td class="is-family-monospace">{{ r.student }}</td>
          <td class="has-text-right">{{ r.total_net }}</td>

          {# render +N only if positive; show 0 or negative as-is #}
          <td class="has-text-right">
            {% if r.over_median > 0 %}
              +{{ r.over_median }}
            {% else %}
              {{ r.over_median }}
            {% endif %}
          </td>

          <td class="has-text-right">
            <span
              class="tag {% if r.pctl >= 99 %}is-danger{% elif r.pctl >= 95 %}is-warning{% else %}is-light{% endif %}"
              title="Approximate percentile among all submissions">
              p{{ r.pctl }}
            </span>
          </td>

          <td class="has-text-right">
            <a class="button is-small" href="/admin/submissions/{{ r.sub_id }}">open</a>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="has-text-grey">No high-traffic outliers</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
