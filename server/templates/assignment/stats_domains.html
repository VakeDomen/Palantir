<div class="box column is-12">
  <p class="is-size-6 has-text-weight-semibold">Top domains</p>

  <div class="is-flex is-align-items-center is-flex-wrap-wrap">
    {% for d in domains %}
    <img class="image is-24x24" src="https://www.google.com/s2/favicons?domain_url={{ d }}" alt="{{ d }}"
      title="{{ d }}">
    {% else %}
    <span class="has-text-grey is-size-7">No domains</span>
    {% endfor %}
  </div>

  <div style="position:relative;width:100%;height:220px" class="mt-3">
    <canvas id="dom-{{ aid }}"></canvas>
  </div>
</div>

<script>
  (() => {
    const ctx = document.getElementById("dom-{{ aid }}")?.getContext("2d");
    if (!ctx) return;
    const labels = {{ domains_json | safe
  }};
  const data = {{ hits_json    | safe }};
  new Chart(ctx, {
    type: "bar",
    data: { labels, datasets: [{ label: "hits", data }] },
    options: {
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
}) ();
</script>